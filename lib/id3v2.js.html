<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title> - id3v2.js</title>

  <link rel="stylesheet" href="../assets/style.css">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"/>
  <meta name="groc-relative-root" content="../"/>
  <meta name="groc-document-path" content="lib/id3v2.js"/>
  
</head>
<body>
  <div id="file-area">
    <div id="meta">
      <code class="file-path">
      
        <a href="https://github.com/biril/mp3-parser/blob/master/lib/id3v2.js">lib/id3v2.js</a>
      
      </code>
    </div>
    <div id="document">
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><pre><code>mp3-<span class="hljs-keyword">parser</span>/id3v2 v0<span class="hljs-number">.2</span><span class="hljs-number">.0</span>
</code></pre></div>
        </div>
      
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><pre><code><span class="hljs-keyword">https</span>://github.com/biril/mp3-parser
Licensed <span class="hljs-operator">and</span> freely distributed under <span class="hljs-operator">the</span> MIT License
Copyright (c) <span class="hljs-number">2013</span>-<span class="hljs-number">2014</span> Alex Lambiris
</code></pre></div>
        </div>
      
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><hr>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper"><span class="hljs-comment">/*jshint browser:true */</span>
<span class="hljs-comment">/*global exports:false, define:false, require:false */</span>
(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(globalObject, createModule)</span> {</span>
<span class="hljs-pi">    "use strict"</span>;
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Export as a module or global depending on environment:</p>
</div>
        </div>
      
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Global <code>define</code> method with <code>amd</code> property signifies an AMD loader (require.js, curl.js, ..)</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> define === <span class="hljs-string">"function"</span> &amp;&amp; define.amd) {
        <span class="hljs-keyword">return</span> define([<span class="hljs-string">"exports"</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(exports)</span> {</span>
            <span class="hljs-keyword">return</span> createModule(exports, <span class="hljs-built_in">require</span>(<span class="hljs-string">"./lib"</span>));
        });
    }
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Global <code>exports</code> object signifies CommonJS enviroments with <code>module.exports</code>, e.g. Node</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> exports === <span class="hljs-string">"object"</span>) {
        <span class="hljs-keyword">return</span> createModule(exports, <span class="hljs-built_in">require</span>(<span class="hljs-string">"./lib"</span>));
    }
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>If none of the above, then assume a browser sans AMD (also attach a <code>noConflict</code>)</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-keyword">var</span> previousMp3Id3v2Parser = globalObject.mp3Id3v2Parser;
    createModule(globalObject.mp3Id3v2Parser = {
        noConflict: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> mp3Id3v2Parser = globalObject.mp3Id3v2Parser;
            globalObject.mp3Id3v2Parser = previousMp3Id3v2Parser;
            <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>.noConflict = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span> <span class="hljs-keyword">return</span> mp3Id3v2Parser; }).call();
        }
    }, globalObject.lib);

}(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(mp3Id3v2Parser, lib)</span> {</span>
<span class="hljs-pi">    "use strict"</span>;

    <span class="hljs-keyword">var</span> id3v2TagFrameNames = {
            AENC: <span class="hljs-string">"Audio encryption"</span>,
            APIC: <span class="hljs-string">"Attached picture"</span>,
            COMM: <span class="hljs-string">"Comments"</span>,
            COMR: <span class="hljs-string">"Commercial frame"</span>,
            ENCR: <span class="hljs-string">"Encryption method registration"</span>,
            EQUA: <span class="hljs-string">"Equalization"</span>,
            ETCO: <span class="hljs-string">"Event timing codes"</span>,
            GEOB: <span class="hljs-string">"General encapsulated object"</span>,
            GRID: <span class="hljs-string">"Group identification registration"</span>,
            IPLS: <span class="hljs-string">"Involved people list"</span>,
            LINK: <span class="hljs-string">"Linked information"</span>,
            MCDI: <span class="hljs-string">"Music CD identifier"</span>,
            MLLT: <span class="hljs-string">"MPEG location lookup table"</span>,
            OWNE: <span class="hljs-string">"Ownership frame"</span>,
            PRIV: <span class="hljs-string">"Private frame"</span>,
            PCNT: <span class="hljs-string">"Play counter"</span>,
            POPM: <span class="hljs-string">"Popularimeter"</span>,
            POSS: <span class="hljs-string">"Position synchronisation frame"</span>,
            RBUF: <span class="hljs-string">"Recommended buffer size"</span>,
            RVAD: <span class="hljs-string">"Relative volume adjustment"</span>,
            RVRB: <span class="hljs-string">"Reverb"</span>,
            SYLT: <span class="hljs-string">"Synchronized lyric/text"</span>,
            SYTC: <span class="hljs-string">"Synchronized tempo codes"</span>,
            TALB: <span class="hljs-string">"Album/Movie/Show title"</span>,
            TBPM: <span class="hljs-string">"BPM (beats per minute)"</span>,
            TCOM: <span class="hljs-string">"Composer"</span>,
            TCON: <span class="hljs-string">"Content type"</span>,
            TCOP: <span class="hljs-string">"Copyright message"</span>,
            TDAT: <span class="hljs-string">"Date"</span>,
            TDLY: <span class="hljs-string">"Playlist delay"</span>,
            TENC: <span class="hljs-string">"Encoded by"</span>,
            TEXT: <span class="hljs-string">"Lyricist/Text writer"</span>,
            TFLT: <span class="hljs-string">"File type"</span>,
            TIME: <span class="hljs-string">"Time"</span>,
            TIT1: <span class="hljs-string">"Content group description"</span>,
            TIT2: <span class="hljs-string">"Title/songname/content description"</span>,
            TIT3: <span class="hljs-string">"Subtitle/Description refinement"</span>,
            TKEY: <span class="hljs-string">"Initial key"</span>,
            TLAN: <span class="hljs-string">"Language(s)"</span>,
            TLEN: <span class="hljs-string">"Length"</span>,
            TMED: <span class="hljs-string">"Media type"</span>,
            TOAL: <span class="hljs-string">"Original album/movie/show title"</span>,
            TOFN: <span class="hljs-string">"Original filename"</span>,
            TOLY: <span class="hljs-string">"Original lyricist(s)/text writer(s)"</span>,
            TOPE: <span class="hljs-string">"Original artist(s)/performer(s)"</span>,
            TORY: <span class="hljs-string">"Original release year"</span>,
            TOWN: <span class="hljs-string">"File owner/licensee"</span>,
            TPE1: <span class="hljs-string">"Lead performer(s)/Soloist(s)"</span>,
            TPE2: <span class="hljs-string">"Band/orchestra/accompaniment"</span>,
            TPE3: <span class="hljs-string">"Conductor/performer refinement"</span>,
            TPE4: <span class="hljs-string">"Interpreted, remixed, or otherwise modified by"</span>,
            TPOS: <span class="hljs-string">"Part of a set"</span>,
            TPUB: <span class="hljs-string">"Publisher"</span>,
            TRCK: <span class="hljs-string">"Track number/Position in set"</span>,
            TRDA: <span class="hljs-string">"Recording dates"</span>,
            TRSN: <span class="hljs-string">"Internet radio station name"</span>,
            TRSO: <span class="hljs-string">"Internet radio station owner"</span>,
            TSIZ: <span class="hljs-string">"Size"</span>,
            TSRC: <span class="hljs-string">"ISRC (international standard recording code)"</span>,
            TSSE: <span class="hljs-string">"Software/Hardware and settings used for encoding"</span>,
            TYER: <span class="hljs-string">"Year"</span>,
            TXXX: <span class="hljs-string">"User defined text information frame"</span>,
            UFID: <span class="hljs-string">"Unique file identifier"</span>,
            USER: <span class="hljs-string">"Terms of use"</span>,
            USLT: <span class="hljs-string">"Unsychronized lyric/text transcription"</span>,
            WCOM: <span class="hljs-string">"Commercial information"</span>,
            WCOP: <span class="hljs-string">"Copyright/Legal information"</span>,
            WOAF: <span class="hljs-string">"Official audio file webpage"</span>,
            WOAR: <span class="hljs-string">"Official artist/performer webpage"</span>,
            WOAS: <span class="hljs-string">"Official audio source webpage"</span>,
            WORS: <span class="hljs-string">"Official internet radio station homepage"</span>,
            WPAY: <span class="hljs-string">"Payment"</span>,
            WPUB: <span class="hljs-string">"Publishers official webpage"</span>,
            WXXX: <span class="hljs-string">"User defined URL link frame"</span>
        },
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>&#39;ID3&#39; character sequence converted to a handy byte array</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        id3Seq = lib.seqFromStr(<span class="hljs-string">"ID3"</span>),
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Read the content of an ID3v2
 <a href="http://id3.org/id3v2.3.0#Text_information_frames">text-information frame</a>. These are
 common and contain info such as artist and album. There may only be one text info frame
 of its kind in a tag. If the textstring is followed by a termination (00) all the
 following information should be ignored and not be displayed. All text frame
 identifiers begin with &quot;T&quot;. Only text frame identifiers begin with &quot;T&quot;, with the
 exception of the &quot;TXXX&quot; frame</p>
<ul>
<li>Encoding:    a single octet where 0 = ISO-8859-1, 1 = UCS-2</li>
<li>Information: a text string according to encoding</li>
</ul>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        readId3v2TagFrameContentT = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(buffer, offset, length)</span> {</span>
            <span class="hljs-keyword">var</span> content = { encoding: buffer.getUint8(offset) };
            content.value = (content.encoding === <span class="hljs-number">0</span> ? lib.readStr :
                lib.readStrUcs2)(buffer, offset + <span class="hljs-number">1</span>, length - <span class="hljs-number">1</span>);
            <span class="hljs-keyword">return</span> content;
        },
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Read the content of an ID3v2
 (user-defined text-information frame)[<a href="http://id3.org/id3v2.3.0#User_defined_text_information_frame">http://id3.org/id3v2.3.0#User_defined_text_information_frame</a>].
 Intended for one-string text information concerning the audiofile in a similar way to
 the other &quot;T&quot;-frames. The frame body consists of a description of the string,
 represented as a terminated string, followed by the actual string. There may be more
 than one &quot;TXXX&quot; frame in each tag, but only one with the same description</p>
<ul>
<li>Encoding:    a single octet where 0 = ISO-8859-1, 1 = UCS-2</li>
<li>Description: a text string according to encoding (followed by 00 (00))</li>
<li>Value:       a text string according to encoding</li>
</ul>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        readId3v2TagFrameContentTxxx = <span class="hljs-function"><span class="hljs-keyword">function</span>  <span class="hljs-params">(buffer, offset, length)</span> {</span>
            <span class="hljs-keyword">var</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>The content to be returned</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">                content = { encoding: buffer.getUint8(offset) },
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Offsets</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">                offsetBeg = offset + <span class="hljs-number">1</span>, <span class="hljs-comment">// content beginning (description field)</span>
                offsetTrm,              <span class="hljs-comment">// content null-terminator (seperates descr / value fields)</span>

                isEncodingUcs2 = content.encoding === <span class="hljs-number">1</span>,
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Choose appropriate string-reader depending on encoding</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">                readS = isEncodingUcs2 ? lib.readStrUcs2 : lib.readStr;
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Encoding + null term. = at least 2 octets</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">            <span class="hljs-keyword">if</span> (length &lt; <span class="hljs-number">2</span>) {
                <span class="hljs-keyword">return</span> content; <span class="hljs-comment">// Inadequate length!</span>
            }
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Locate the the null terminator seperating description and URL</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">            offsetTrm = (isEncodingUcs2 ? lib.locateStrTrmUcs2 :
                lib.locateStrTrm)(buffer, offsetBeg, length - <span class="hljs-number">4</span>);
            <span class="hljs-keyword">if</span> (offsetTrm === -<span class="hljs-number">1</span>) {
                <span class="hljs-keyword">return</span> content; <span class="hljs-comment">// Not found!</span>
            }
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Read data</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">            content.description = readS(buffer, offsetBeg, offsetTrm - offsetBeg);
            offsetTrm += isEncodingUcs2 ? <span class="hljs-number">2</span> : <span class="hljs-number">1</span>; <span class="hljs-comment">// Move past terminating sequence</span>
            content.value = readS(buffer, offsetTrm, offset + length - offsetTrm);

            <span class="hljs-keyword">return</span> content;
        },
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Read the content of an ID3v2
 <a href="http://id3.org/id3v2.3.0#URL_link_frames">URL-link frame</a>. There may only be one
 URL link frame of its kind in a tag, except when stated otherwise in the frame
 description. If the textstring is followed by a termination (00) all the following
 information should be ignored and not be displayed. All URL link frame identifiers
 begins with &quot;W&quot;. Only URL link frame identifiers begins with &quot;W&quot;</p>
<ul>
<li>URL: a text string</li>
</ul>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        readId3v2TagFrameContentW = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(buffer, offset, length)</span> {</span>
            <span class="hljs-keyword">return</span> { value: lib.readStr(buffer, offset, length) };
        },
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Read the content of an ID3v2
 <a href="http://id3.org/id3v2.3.0#User_defined_URL_link_frame">user-defined URL-link frame</a>.
 Intended for URL links concerning the audiofile in a similar way to the other
 &quot;W&quot;-frames. The frame body consists of a description of the string, represented as a
 terminated string, followed by the actual URL. The URL is always encoded with
 ISO-8859-1. There may be more than one &quot;WXXX&quot; frame in each tag, but only one with the
 same description</p>
<ul>
<li>Encoding:    a single octet where 0 = ISO-8859-1, 1 = UCS-2</li>
<li>Description: a text string according to encoding (followed by 00 (00))</li>
<li>URL:         a text string</li>
</ul>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        readId3v2TagFrameContentWxxx = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(buffer, offset, length)</span> {</span>
            <span class="hljs-keyword">var</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>The content to be returned</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">                content = { encoding: buffer.getUint8(offset) },
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Offsets</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">                offsetBeg = offset + <span class="hljs-number">1</span>, <span class="hljs-comment">// content beginning (description field)</span>
                offsetTrm,              <span class="hljs-comment">// content null-terminator (seperates descr / URL fields)</span>

                isEncodingUcs2 = content.encoding === <span class="hljs-number">1</span>,
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Choose appropriate string-reader depending on encoding</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">                readS = isEncodingUcs2 ? lib.readStrUcs2 : lib.readStr;
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Encoding + null term. = at least 2 octets</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">            <span class="hljs-keyword">if</span> (length &lt; <span class="hljs-number">2</span>) {
                <span class="hljs-keyword">return</span> content; <span class="hljs-comment">// Inadequate length!</span>
            }
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Locate the the null terminator seperating description and URL</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">            offsetTrm = (isEncodingUcs2 ? lib.locateStrTrmUcs2 :
                lib.locateStrTrm)(buffer, offsetBeg, length - <span class="hljs-number">4</span>);
            <span class="hljs-keyword">if</span> (offsetTrm === -<span class="hljs-number">1</span>) {
                <span class="hljs-keyword">return</span> content; <span class="hljs-comment">// Not found!</span>
            }
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Read data</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">            content.description = readS(buffer, offsetBeg, offsetTrm - offsetBeg);
            offsetTrm += isEncodingUcs2 ? <span class="hljs-number">2</span> : <span class="hljs-number">1</span>; <span class="hljs-comment">// Move past terminating sequence</span>
            content.value = lib.readStr(buffer, offsetTrm, offset + length - offsetTrm);

            <span class="hljs-keyword">return</span> content;
        },
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Read the content of an ID3v2 <a href="http://id3.org/id3v2.3.0#Comments">comment frame</a>.
 Intended for any kind of full text information that does not fit in any other frame.
 Consists of a frame header followed by encoding, language and content descriptors and
 ends with the actual comment as a text string. Newline characters are allowed in the
 comment text string. There may be more than one comment frame in each tag, but only one
 with the same language and content descriptor</p>
<ul>
<li>Encoding:    a single octet where 0 = ISO-8859-1, 1 = UCS-2</li>
<li>Language:    3 digit (octet) lang-code (ISO-639-2)</li>
<li>Short descr: a text string according to encoding (followed by 00 (00))</li>
<li>Actual text: a text string according to encoding</li>
</ul>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        readId3v2TagFrameContentComm = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(buffer, offset, length)</span> {</span>
            <span class="hljs-keyword">var</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>The content to be returned</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">                content = { encoding: buffer.getUint8(offset) },
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Offsets</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">                offsetBeg = offset + <span class="hljs-number">4</span>, <span class="hljs-comment">// content beginning (description field)</span>
                offsetTrm,              <span class="hljs-comment">// content null-terminator (seperates descr / text fields)</span>

                isEncodingUcs2 = content.encoding === <span class="hljs-number">1</span>,
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Choose appropriate string-reader depending on encoding</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">                readS = isEncodingUcs2 ? lib.readStrUcs2 : lib.readStr;
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Encoding + language + null term. = at least 5 octets</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">            <span class="hljs-keyword">if</span> (length &lt; <span class="hljs-number">5</span>) {
                <span class="hljs-keyword">return</span> content; <span class="hljs-comment">// Inadequate length!</span>
            }
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Read the language field - 3 octets at most</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">            content.language = lib.readTrmStr(buffer, offset + <span class="hljs-number">1</span>, <span class="hljs-number">3</span>);
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Locate the the null terminator seperating description and text</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">            offsetTrm = (isEncodingUcs2 ? lib.locateStrTrmUcs2 :
                lib.locateStrTrm)(buffer, offsetBeg, length - <span class="hljs-number">4</span>);
            <span class="hljs-keyword">if</span> (offsetTrm === -<span class="hljs-number">1</span>) {
                <span class="hljs-keyword">return</span> content; <span class="hljs-comment">// Not found!</span>
            }
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Read data</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">            content.description = readS(buffer, offsetBeg, offsetTrm - offsetBeg);
            offsetTrm += isEncodingUcs2 ? <span class="hljs-number">2</span> : <span class="hljs-number">1</span>; <span class="hljs-comment">// Move past terminating sequence</span>
            content.text = readS(buffer, offsetTrm, offset + length - offsetTrm);

            <span class="hljs-keyword">return</span> content;
        },
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Read the content of an ID3v2
 <a href="http://id3.org/id3v2.3.0#Unique_file_identifier">unique file identifier frame</a>. Allows
 identification of the audio file by means of some database that may contain more
 information relevant to the content. All frames begin with a null-terminated string - a
 URL containing an email address, or a link to a location where an email address can be
 found - that belongs to the organisation responsible for this specific database
 implementation. The &#39;Owner identifier&#39; must be non-empty (more than just a termination)
 and is followed by the actual identifier, which may be up to 64 bytes. There may be
 more than one &quot;UFID&quot; frame in a tag, but only one with the same &#39;Owner identifier&#39;.</p>
<ul>
<li>Owner identifier: a text string (followed by 00)</li>
<li>Identifier:       up to 64 bytes of binary data</li>
</ul>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        readId3v2TagFrameContentUfid = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(buffer, offset, length)</span> {</span>
            <span class="hljs-keyword">var</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Read up to the first null terminator to get the owner-identifier</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">                ownerIdentifier = lib.readTrmStr(buffer, offset, length),
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Figure out the identifier based on frame length vs owner-identifier length</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">                identifier = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DataView</span>(buffer.buffer, offset + ownerIdentifier.length + <span class="hljs-number">1</span>,
                    length - ownerIdentifier.length - <span class="hljs-number">1</span>);

            <span class="hljs-keyword">return</span> { ownerIdentifier: ownerIdentifier, identifier: identifier };
        };
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><h3 id="read-an-id3v2-tag-frame"><a href="#read-an-id3v2-tag-frame" class="anchor"></a>Read an ID3v2 Tag Frame</h3><p>Read <a href="http://id3.org/id3v2.3.0#Declared_ID3v2_frames">ID3v2 Tag frame</a> located at <code>offset</code>
 of DataView <code>buffer</code>. Returns null in the event that no tag-frame is found at <code>offset</code></p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    mp3Id3v2Parser.readId3v2TagFrame = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(buffer, offset)</span> {</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>All frames consist of a frame header followed by one or more fields containing the actual
information. The frame header is 10 octets long and laid out as <code>IIIISSSSFF</code>, where</p>
<ul>
<li><code>IIII......</code>: Frame id (four characters)</li>
<li><code>....SSSS..</code>: Size (frame size excluding frame header = frame size - 10)</li>
<li><code>........FF</code>: Flags</li>
</ul>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        <span class="hljs-keyword">var</span> frame = {
                header: {
                    id: lib.readStr(buffer, offset, <span class="hljs-number">4</span>),
                    size: buffer.getUint32(offset + <span class="hljs-number">4</span>),
                    flagsOctet1: buffer.getUint8(offset + <span class="hljs-number">8</span>),
                    flagsOctet2: buffer.getUint8(offset + <span class="hljs-number">9</span>)
                }
            };
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Frame&#39;s friendly name</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        frame.name = id3v2TagFrameNames[frame.header.id];
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>An ID3v2 tag frame must have a length of at least 1 octet, excluding the header</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        <span class="hljs-keyword">if</span> (frame.size &lt; <span class="hljs-number">1</span>) { <span class="hljs-keyword">return</span> frame; }
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Read frame&#39;s content</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        frame.content = (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(id)</span> {</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>User-defined text-information frames</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">            <span class="hljs-keyword">if</span> (id === <span class="hljs-string">"TXXX"</span>) { <span class="hljs-keyword">return</span> readId3v2TagFrameContentTxxx; }</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Text-information frames</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">            <span class="hljs-keyword">if</span> (id.charAt(<span class="hljs-number">0</span>) === <span class="hljs-string">"T"</span>) { <span class="hljs-keyword">return</span> readId3v2TagFrameContentT; }</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>User-defined URL-link frames</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">            <span class="hljs-keyword">if</span> (id === <span class="hljs-string">"WXXX"</span>) { <span class="hljs-keyword">return</span> readId3v2TagFrameContentWxxx; }</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>URL-link frames</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">            <span class="hljs-keyword">if</span> (id.charAt(<span class="hljs-number">0</span>) === <span class="hljs-string">"W"</span>) { <span class="hljs-keyword">return</span> readId3v2TagFrameContentW; }</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Comment frames</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">            <span class="hljs-keyword">if</span> (id === <span class="hljs-string">"COMM"</span>) { <span class="hljs-keyword">return</span> readId3v2TagFrameContentComm; }</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Unique-file-identifier frames</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">            <span class="hljs-keyword">if</span> (id === <span class="hljs-string">"UFID"</span>) { <span class="hljs-keyword">return</span> readId3v2TagFrameContentUfid; }</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Unknown frame - &#39;parse it&#39; using a no-op returning <code>undefined</code> content</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">            <span class="hljs-keyword">return</span> lib.noOp;
        }(frame.header.id))(buffer, offset + <span class="hljs-number">10</span>, frame.header.size);

        <span class="hljs-keyword">return</span> frame;
    };

</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><h3 id="read-the-id3v2-tag"><a href="#read-the-id3v2-tag" class="anchor"></a>Read the ID3v2 Tag</h3><p>Read <a href="http://id3.org/id3v2.3.0">ID3v2 Tag</a> located at <code>offset</code> of DataView <code>buffer</code>. Returns
 null in the event that no tag is found at <code>offset</code></p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    mp3Id3v2Parser.readId3v2Tag = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(buffer, offset)</span> {</span>
        offset || (offset = <span class="hljs-number">0</span>);
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>The ID3v2 tag header, which should be the first information in the file, is 10 octets
 long and laid out as <code>IIIVVFSSSS</code>, where</p>
<ul>
<li><code>III.......</code>: id, always &quot;ID3&quot; (0x49/73, 0x44/68, 0x33/51)</li>
<li><code>...VV.....</code>: version (major version + revision number)</li>
<li><code>.....F....</code>: flags: abc00000. a:unsynchronisation, b:extended header, c:experimental</li>
<li><code>......SSSS</code>: tag&#39;s size as a synchsafe integer</li>
</ul>
</div>
        </div>
      
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>There should be at least 10 bytes ahead</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        <span class="hljs-keyword">if</span> (buffer.byteLength - offset &lt; <span class="hljs-number">10</span>) { <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; }
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>The &#39;ID3&#39; identifier is expected at given offset</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        <span class="hljs-keyword">if</span> (!lib.isSeq(id3Seq, buffer, offset)) { <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; }

        <span class="hljs-keyword">var</span>
            flagsOctet = buffer.getUint8(offset + <span class="hljs-number">5</span>),

            tag = {
                _section: {
                    type: <span class="hljs-string">"ID3v2"</span>,
                    offset: offset
                },
                header: {
                    majorVersion: buffer.getUint8(offset + <span class="hljs-number">3</span>),
                    minorRevision: buffer.getUint8(offset + <span class="hljs-number">4</span>),
                    flagsOctet: flagsOctet,
                    unsynchronisationFlag: (flagsOctet &amp; <span class="hljs-number">128</span>) === <span class="hljs-number">128</span>,
                    extendedHeaderFlag: (flagsOctet &amp; <span class="hljs-number">64</span>) === <span class="hljs-number">64</span>,
                    experimentalIndicatorFlag: (flagsOctet &amp; <span class="hljs-number">32</span>) === <span class="hljs-number">32</span>,
                    size: lib.unsynchsafe(buffer.getUint32(offset + <span class="hljs-number">6</span>))
                },
                frames: []
            },
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Index of octet following tag&#39;s last octet: The tag spans [offset, tagEnd)
 (including the first 10 header octets)</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">            tagEnd,
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>To store frames as they&#39;re discovered while paring the tag</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">            frame;
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>The size as expressed in the header is the size of the complete tag after
 unsychronisation, including padding, excluding the header but not excluding the
 extended header (total tag size - 10)</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        tag._section.byteLength = tag.header.size + <span class="hljs-number">10</span>;
        tagEnd = offset + tag._section.byteLength;
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>TODO: Process extended header if present. The presence of an extended header will affect
 the offset. Currently, it is asummed that no extended header is present so the offset
 is fixed at 10 octets</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        <span class="hljs-keyword">if</span> (tag.header.extendedHeaderFlag) {}
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Go on to read individual frames but only if the tag version is v2.3. This is the only
 version currently supported</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        <span class="hljs-keyword">if</span> (tag.header.majorVersion !== <span class="hljs-number">3</span>) { <span class="hljs-keyword">return</span> tag; }
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Move offset past the end of the tag header to start reading tag frames</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        offset += <span class="hljs-number">10</span>;
        <span class="hljs-keyword">while</span> (offset &lt; tagEnd) {
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Locating a frame with a zeroed out id indicates that all valid frames have already
 been parsed. It&#39;s all dead space hereon so practically we&#39;re done</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">            <span class="hljs-keyword">if</span> (buffer.getUint32(offset) === <span class="hljs-number">0</span>) { <span class="hljs-keyword">break</span>; }

            frame = mp3Id3v2Parser.readId3v2TagFrame(buffer, offset);
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Couldn&#39;t parse this frame so bail out</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">            <span class="hljs-keyword">if</span> (!frame) { <span class="hljs-keyword">break</span>; }

            tag.frames.push(frame);
            offset += frame.header.size + <span class="hljs-number">10</span>;
        }

        <span class="hljs-keyword">return</span> tag;
    };

}));
</div></div>
      
      </div>
    
    </div>
  </div>

  <script src="../toc.js"></script>
  <script src="../assets/libs.js"></script>
  <script src="../assets/behavior.js"></script>
</body>
</html>